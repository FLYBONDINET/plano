<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAEZ-ATCCTRL</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <i class="fa-solid fa-tower-observation brand-icon" aria-hidden="true"></i>
        <div class="brand-text">
          <div class="brand-title">SAEZ-ATCCTRL</div>
          <div class="brand-subtitle">OCC • Ezeiza (SAEZ)</div>
        </div>
      </div>

      <div class="topbar-actions">
        <div class="status-pill" id="connPill" title="Estado de datos">
          <span class="dot" id="connDot"></span>
          <span id="connText">Sin datos</span>
        </div>

        <button class="btn btn-ghost" id="btnRefresh" title="Refrescar y actualizar datos extraídos">
          <i class="fa-solid fa-rotate"></i>
          <span>Refrescar</span>
        </button>

        <button class="btn btn-primary" id="btnEdit" title="Entrar / salir modo editor">
          <i class="fa-solid fa-pen-to-square"></i>
          <span>Editar</span>
        </button>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <div class="panel">
          <div class="panel-title">
            <i class="fa-solid fa-location-dot"></i>
            <span>Posiciones</span>
            <span class="panel-badge" id="posCount">0</span>
          </div>
          <div class="panel-body" id="positionsList"></div>
          <div class="panel-footer">
            <div class="hint">
              <i class="fa-solid fa-circle-info"></i>
              <span>En modo editor: click en el mapa para crear una posición.</span>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">
            <i class="fa-solid fa-plane"></i>
            <span>Vuelos</span>
            <span class="panel-badge" id="fltCount">0</span>
          </div>
          <div class="panel-body" id="flightsList"></div>
        </div>

        <div class="panel">
          <div class="panel-title">
            <i class="fa-solid fa-clock"></i>
            <span>Timelapse</span>
          </div>
          <div class="panel-body">
            <div class="timebox">
              <div class="timebox-row">
                <div class="timebox-label">Hora simulada</div>
                <div class="timebox-value" id="simTime">--:--</div>
              </div>
              <input id="timeSlider" type="range" min="0" max="1439" value="720" />
              <div class="timebox-controls">
                <button class="btn btn-ghost" id="btnPlay"><i class="fa-solid fa-play"></i><span>Play</span></button>
                <button class="btn btn-ghost" id="btnPause" disabled><i class="fa-solid fa-pause"></i><span>Pausa</span></button>
                <select id="speedSel" class="select">
                  <option value="1">x1</option>
                  <option value="2">x2</option>
                  <option value="5">x5</option>
                  <option value="10">x10</option>
                </select>
              </div>
              <div class="hint small">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                <span>El timelapse filtra/actualiza estados según horas disponibles.</span>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <section class="map-wrap">
        <div id="map"></div>

        <!-- Overlay helper for editor -->
        <div class="editor-badge" id="editorBadge" hidden>
          <i class="fa-solid fa-lock-open"></i>
          <span>Modo editor</span>
        </div>

        <!-- Popup modal -->
        <div class="modal-backdrop" id="modalBackdrop" hidden>
          <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modal-header">
              <div class="modal-title" id="modalTitle">Nueva posición</div>
              <button class="icon-btn" id="modalClose" aria-label="Cerrar">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
          </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast" hidden></div>
      </section>
    </main>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <!-- App scripts -->
  <script src="js/api.js"></script>
  <script src="js/editor.js"></script>
  <script src="js/timelapse.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
